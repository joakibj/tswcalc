/*! tswcalc version 1.15.0 2020-06-01 */
!function(){function a(a,b){return a.write('<div class="btn-group"><button id="btn-reset" class="btn btn-danger">Reset</button></div><div class="btn-group"><button id="btn-all-3" class="btn">All DPS</button><button id="btn-all-2" class="btn">All Healer</button><button id="btn-all-1" class="btn">All Tank</button></div><div class="btn-group"><button id="btn-all-10-4" class="btn">All 10.4</button><button id="btn-all-10-5" class="btn">All 10.5</button><button id="btn-all-10-9" class="btn">All 10.9</button><button id="btn-all-11-0" class="btn">All 11.0</button></div><div class="btn-group"><a class="btn btn-info dropdown-toggle" data-toggle="dropdown" href="#">Export<span class="caret"></span></a><ul class="dropdown-menu"><li><a class="export" href="#open-export-modal" data="url" data-toggle="modal">URL</a></li><li><a class="export" href="#open-export-modal" data="bbcode" data-toggle="modal">BBCode</a></li></ul></div><div id="open-export-modal" class="modal hide fade"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h5>Export</h5></div><div class="modal-body">Copy this and share:<br/><textarea id="export-textarea" class="field span12" wrap="off" rows="10"></textarea></div></div>')}dust.register("buttonbar",a)}(),function(){function a(a,b){return a.write('<div class="masthead"><ul class="nav nav-pills pull-right"><li class="active"><a href="#">Calculator</a></li><li><a href="https://github.com/joakibj/tswcalc" target="_blank">Github</a></li></ul><h2 class="logo lightgrey"><span class="templar">t</span><span class="illuminati">s</span><span class="dragon">w</span><span class="darkgrey">calc</span> <span class="slogan">Make your builds come true.</span></h2></div><hr><div class="row-fluid"><div class="span12">').partial("buttonbar",b,null).write('</div></div><hr/><div class="row-fluid"><div class="span8">').partial("slots",b,null).partial("miscslot",b,null).write('</div><div class="span4">').partial("summary",b,null).write('</div></div><hr><div class="footer"><p>tswcalc &copy; 2013-2020 Joakim Bj&oslash;rnstad. Version <a href="https://github.com/joakibj/tswcalc/releases/tag/1.15.0" target="_new">1.15.0</a>. Hosted on Github Pages.</p></div>')}dust.register("container",a)}(),function(){function a(a,c){return a.write("[size=3]Configuration Output[/size]\n\n[size=2]Summary[/size]\n\n").section(c.get("summary"),c,{block:b},null).write("\n\n[size=2]Gear report[/size]\n\n[size=-1]").section(c.get("slotState"),c,{block:e},null).write("[/size]")}function b(a,b){return a.write("[size=-1]").section(b.get("primary"),b,{block:c},null).section(b.get("offensive_defensive"),b,{block:d},null).write("[/size]")}function c(a,b){return a.write("[b]Primary stats[/b]\n[indent]Hitpoints: [b]").reference(b.get("hitpoints"),b,"h").write("[/b][/indent]\n[indent]Combat Power: [b]").reference(b.get("combat-power"),b,"h").write("[/b][/indent]\n[indent]Attack Rating: [b]").reference(b.get("attack-rating"),b,"h").write("[/b][/indent]\n[indent]Weapon Power: [b]").reference(b.get("weapon-power"),b,"h").write("[/b][/indent]\n[indent]Heal Rating: [b]").reference(b.get("heal-rating"),b,"h").write("[/b][/indent]\n")}function d(a,b){return a.write("[b]Offensive stats[/b]\n[indent]Critical Rating: [b][color=green]").reference(b.get("critical-rating"),b,"h").write("[/color][/b][/indent]\n[indent]Critical Chance: [b][color=green]").reference(b.get("critical-chance"),b,"h").write(" %[/color][/b][/indent]\n[indent]Critical Power Rating: [b][color=green]").reference(b.get("critical-power"),b,"h").write("[/color][/b][/indent]\n[indent]Critical Power: [b][color=green]").reference(b.get("critical-power-percentage"),b,"h").write(" %[/color][/b][/indent]\n[indent]Penetration Rating: [b][color=green]").reference(b.get("penetration-rating"),b,"h").write("[/color][/b][/indent]\n[indent]Hit Rating: [b][color=green]").reference(b.get("hit-rating"),b,"h").write("[/color][/b][/indent]\n[b]Defensive stats[/b]\n[indent]Block Rating: [b][color=green]").reference(b.get("block-rating"),b,"h").write("[/color][/b][/indent]\n[indent]Defense Rating: [b][color=green]").reference(b.get("defense-rating"),b,"h").write("[/color][/b][/indent]\n[indent]Evade Rating: [b][color=green]").reference(b.get("evade-rating"),b,"h").write("[/color][/b][/indent]\n[indent]Evade Chance: [b][color=green]").reference(b.get("evade-chance"),b,"h").write(" %[/color][/b][/indent]\n[indent]Physical Protection: [b][color=green]").reference(b.get("physical-protection"),b,"h").write("[/color][/b][/indent]\n[indent]Magical Protection: [b][color=green]").reference(b.get("magical-protection"),b,"h").write("[/color][/b][/indent]\n")}function e(a,b){return a.write("[b]").reference(b.get("name"),b,"h").write(" (").exists(b.get("is_item"),b,{else:f,block:h},null).write(")[/b] ").exists(b.get("stat_type"),b,{block:i},null).write("\n[indent]Glyph (QL [color=purple]10.").reference(b.get("glyph_ql"),b,"h").write("[/color]): ").exists(b.get("primary_glyph"),b,{block:j},null).exists(b.get("secondary_glyph"),b,{block:k},null).write("[/indent]\n").exists(b.get("signet_name"),b,{block:l},null)}function f(a,b){return a.write("QL [color=purple]10.").reference(b.get("ql"),b,"h").write("[/color]").exists(b.get("role"),b,{block:g},null)}function g(a,b){return a.write(" ").reference(b.get("role"),b,"h")}function h(a,b){return a.reference(b.get("signet_name"),b,"h")}function i(a,b){return a.write("[b][color=green]+").reference(b.get("stat_value"),b,"h").write("[/color][/b] ").reference(b.get("stat_type"),b,"h")}function j(a,b){return a.reference(b.get("primary_glyph"),b,"h").write(" [b][color=green]+").reference(b.get("primary_value"),b,"h").write("[/color][/b] (").reference(b.get("primary_dist"),b,"h").write("/4)")}function k(a,b){return a.write(" , ").reference(b.get("secondary_glyph"),b,"h").write(" [b][color=green]+").reference(b.get("secondary_value"),b,"h").write("[/color][/b] (").reference(b.get("secondary_dist"),b,"h").write("/4)")}function l(a,b){return a.write("[indent]Signet ([color=").reference(b.get("signet_colour"),b,"h").write("]").reference(b.get("signet_quality"),b,"h").write("[/color]):").notexists(b.get("is_item"),b,{block:m},null).write(" ").reference(b.get("signet_description"),b,"h").write("[/indent]\n")}function m(a,b){return a.write(" Signet of [b]").reference(b.get("signet_name"),b,"h").write("[/b].")}dust.register("export\bbcode",a)}(),function(){function a(a,b){return a.write('<div id="').reference(b.get("id_prefix"),b,"h").reference(b.get("id_suffix"),b,"h").write('-dist" class="btn-group glyphbuttons"><button id="').reference(b.get("id_prefix"),b,"h").reference(b.get("id_suffix"),b,"h").write('-dist-btn0" class="btn btn-mini btn-danger">0</button><button id="').reference(b.get("id_prefix"),b,"h").reference(b.get("id_suffix"),b,"h").write('-dist-btn1" class="btn btn-mini btn-danger">1</button><button id="').reference(b.get("id_prefix"),b,"h").reference(b.get("id_suffix"),b,"h").write('-dist-btn2" class="btn btn-mini btn-danger">2</button><button id="').reference(b.get("id_prefix"),b,"h").reference(b.get("id_suffix"),b,"h").write('-dist-btn3" class="btn btn-mini btn-danger">3</button><button id="').reference(b.get("id_prefix"),b,"h").reference(b.get("id_suffix"),b,"h").write('-dist-btn4" class="btn btn-mini btn-danger">4</button></div>')}dust.register("glyphbuttons",a)}(),function(){function a(a,b){return a.write('<div id="misc-slot" class="slot"><h4 class="slot">Miscellaneous</h4> <h4 id="misc-name" class="slot-name"></h4><table class="table table-slots"><tr><td><a href="#" class="consumable-tooltip" data-toggle="tooltip" title="Pure Anima consumable. Selecting the consumable will add the stat you your build."><img id="pure-anima-border" class="item-border" src="assets/images/icons/normal.png"/><img id="pure-anima-icon" class="consumable" src="assets/images/icons/pure_anima_ar.png"/></a></td><td><select id="pure-anima" title="Please select Pure Anima"><option value="none">None</option><option value="health">Max Health</option><option value="attack-rating">Attack Rating</option><option value="heal-rating">Heal Rating</option><option value="benefaction-tonic">Benefaction Tonic</option></select></td><td id="pure-anima-description" class="item-description"></td></tr><tr><td><a href="#" class="consumable-tooltip" data-toggle="tooltip" title="Anima consumable. Selecting the consumable will add the stat you your build."><img id="pure-anima-border" class="item-border" src="assets/images/icons/normal.png"/><img id="pure-anima-icon" class="consumable" src="assets/images/icons/anima_crit_rating.png"/></a></td><td><select id="anima" title="Please select Anima"><option value="none">None</option><option value="critical-rating">Crit Rating</option><option value="critical-power">Crit Damage Rating</option><option value="penetration-rating">Penetration Rating</option><option value="hit-rating">Hit Rating</option><option value="block-rating">Block Rating</option><option value="defense-rating">Defense Rating</option><option value="evade-rating">Evade Rating</option><option value="physical-protection">Physical Protection Rating</option><option value="magical-protection">Magical Protection Rating</option></select></td><td id="anima-description" class="item-description"></td></tr></table></div>')}dust.register("miscslot",a)}(),function(){function a(a,c){return a.write('<select id="').reference(c.get("id_prefix"),c,"h").reference(c.get("id_suffix"),c,"h").write('-ql" class="select-ql"  title="Please select QL"><option value="10.0">10.0</option><option value="10.1">10.1</option><option value="10.2">10.2</option><option value="10.3">10.3</option><option value="10.4">10.4</option><option value="10.5">10.5</option>').exists(c.get("is_item"),c,{block:b},null).write('<option value="11.0">11.0</option></select>')}function b(a,b){return a.write('<option value="10.6">10.6</option><option value="10.7">10.7</option><option value="10.8">10.8</option><option value="10.9">10.9</option>')}dust.register("qlselect",a)}(),function(){function a(a,d){return a.section(d.get("slots"),d,{else:b,block:c},null)}function b(a,b){return a.write("<p>No slots found (Bug)!</p>")}function c(a,b){return a.write('<div id="').reference(b.get("id_prefix"),b,"h").write('-slot" class="slot"><h4 class="slot">').reference(b.get("name"),b,"h").write('</h4> <h4 id="').reference(b.get("id_prefix"),b,"h").write('-name" class="slot-name"></h4> <span id="').reference(b.get("id_prefix"),b,"h").write('-name-warning" class="label label-important"><a class="slot-warning" href="#" data-toggle="tooltip"><i class="icon-warning-sign icon-white"></i></a></span><table class="table table-slots"><tr>').notexists(b.get("is_weapon"),b,{else:d,block:e},null).write('<td class="ql-label"><strong>QL:</strong></td><td class="ql-select">').partial("qlselect",b,{id_suffix:"",is_item:"true"}).write("</td>").exists(b.get("is_weapon"),b,{block:f},null).write('<td class="filler"></td></tr></table><div><table id="').reference(b.get("id_prefix"),b,"h").write('-glyphs" class="table table-glyphs"><tr><td class="glyph-ql" rowspan="2"><a href="#" class="glyph-tooltip" data-toggle="tooltip" title="Glyph for the ').reference(b.get("name"),b,"h").write(' slot. Choose which QL and stats it will have in your build."><img src="assets/images/icons/glyph.png" alt="Glyph"/></a> ').partial("qlselect",b,{id_suffix:"-glyph"}).write("</td><td><strong>Primary Stat</strong></td><td>").partial("statselect",b,{id_suffix:"primary"}).write("</td><td><strong>Distribution:</strong> ").partial("glyphbuttons",b,{id_suffix:"-primary-glyph"}).write('</td><td id="').reference(b.get("id_prefix"),b,"h").write('-primary-glyph-value" class="statvalue">0</td></tr><tr><td><strong>Secondary Stat</strong></td><td>').partial("statselect",b,{id_suffix:"secondary"}).write("</td><td><strong>Distribution:</strong> ").partial("glyphbuttons",b,{id_suffix:"-secondary-glyph"}).write('</td><td id="').reference(b.get("id_prefix"),b,"h").write('-secondary-glyph-value" class="statvalue">0</td></tr></table></div><div><table id="').reference(b.get("id_prefix"),b,"h").write('-signets" class="table table-signets"><tr><td><a href="#" class="signet-tooltip" data-toggle="tooltip" title="Signet for the ').reference(b.get("name"),b,"h").write(' slot. Choose the quality and type of signet."><img id="').reference(b.get("id_prefix"),b,"h").write('-signet-img-quality" class="item-border" src="assets/images/icons/normal.png"/><img id="').reference(b.get("id_prefix"),b,"h").write('-signet-img-icon" class="signet" src="assets/images/icons/minor_dps.png"/></a></td><td><select id="').reference(b.get("id_prefix"),b,"h").write('-signet-quality"  title="Please select signet quality"><option value="none" selected="true">Quality</option><option value="normal">Normal</option><option value="elite">Elite</option><option value="epic">Epic</option>').exists(b.get("is_neck"),b,{block:g},null).write('</select></td><td><select id="').reference(b.get("id_prefix"),b,"h").write('-pick-signet" title="Please select signet"></select></td><td id="').reference(b.get("id_prefix"),b,"h").write('-signet-description" class="item-description"></td></tr></table></div></div>  ')}function d(a,b){return a.write('<td class="wtype-label"><strong>Type: </strong></td><td class="wtype-select"><select id="').reference(b.get("id_prefix"),b,"h").write('-wtype" class="select-wtype" title="Please select weapon type"><option value="none" selected="true">None</option><option value="blade">Blade</option><option value="hammer">Hammer</option><option value="fist">Fist</option><option value="blood">Blood</option><option value="chaos">Chaos</option><option value="elementalism">Elementalism</option><option value="shotgun">Shotgun</option><option value="pistol">Pistol</option><option value="assault-rifle">Assault-Rifle</option></select></td>')}function e(a,b){return a.write('<td class="item-label"><strong>Item: </strong></td><td class="item-select"><select id="').reference(b.get("id_prefix"),b,"h").write('-itemId" class="select-item" title="Please select item"></select></td>')}function f(a,b){return a.write('<td><a id="').reference(b.get("id_prefix"),b,"h").write('-swap-weapon" class="btn btn-info swap-weapon" href="#"><i class="icon-retweet icon-white icon-align-left"></i> Swap weapon</a></td>')}function g(a,b){return a.write('<option value="heroic" disabled>Heroic</option>')}dust.register("slots",a)}(),function(){function a(a,b){return a.write('<select id="').reference(b.get("id_prefix"),b,"h").write("-").reference(b.get("id_suffix"),b,"h").write('-glyph" class="select-glyph"  title="Please select stat"><option value="none" selected="true">None</option><option value="critical-rating">Critical Rating</option><option value="critical-power">Critical Power</option><option value="penetration-rating">Penetration Rating</option><option value="hit-rating">Hit Rating</option><option value="block-rating">Block Rating</option><option value="defense-rating">Defense Rating</option><option value="evade-rating">Evade Rating</option><option value="physical-protection">Physical Protection</option><option value="magical-protection">Magical Protection</option></select>')}dust.register("statselect",a)}(),function(){function a(a,b){return a.write('        <div id="summary"><h4>Summary</h4><div id="table-primary"><div class="row-fluid"><span class="span4"><a href="#" class="cost-tooltip" data-toggle="tooltip" title="Black Bullions are rewards for all content."><img src="assets/images/icons/black_bullion.png" alt="Black Bullion"/></a> <span id="bb-cost">0</span></span><span class="span4"><a href="#" class="cost-tooltip" data-toggle="tooltip" title="Marks of the Pantheon are rewards for doing Nightmare content."><img src="assets/images/icons/pantheon.png" alt="Mark of the Pantheon"/></a> <span id="pantheon-cost">0</span></span></div><label class="checkbox" data-toggle="tooltip" title="Include cost of Criterion Upgrades and Astral Fuses into the Black Bullion and Mark of the Pantheon totals."><input type="checkbox" id="summary-include-item-costs"/>Add item costs to currency totals.</label><div class="row-fluid"><span class="span4"><a href="#" class="cost-tooltip" data-toggle="tooltip" title="Criterion Upgrades drop from Raid Bosses or can be purchased at the Nightwatch vendors. Use with a nightwatch weapon/talisman toolkit to create 10.5 gear."><img src="assets/images/icons/criterion_upgrade.png" alt="Criterion Upgrade"/></a> <span id="cu-cost">0</span></span><span class="span4"><a href="#" class="cost-tooltip" data-toggle="tooltip" title="Astral Fuses drop from Raid Bosses or can be purchased at the Nightwatch vendors.Use with a nightwatch glyph toolkit to create 10.5 glyphs."><img src="assets/images/icons/astral_fuse.png" alt="Astral Fuse"/></a> <span id="af-cost">0</span></span></div><div class="row-fluid"><span class="span4"><a href="#" class="cost-tooltip" data-toggle="tooltip" title="Supernal Upgrades drop from Nightmare Raid Bosses. Use with a Supernal Upgrade Kit to create 11.0 gear."><img src="assets/images/icons/supernal_upgrade.png" alt="Supernal Upgrade"/></a> <span id="su-cost">0</span></span><span class="span4"><a href="#" class="cost-tooltip" data-toggle="tooltip" title="11th Hour Glyph Toolkits drop from Nightmare Raid Bosses. Used to assemble QL 11 glyphs from pure materials."><img src="assets/images/icons/toolkit.png" alt="11th Hour Glyph Toolkit"/></a> <span id="11th-cost">0</span></span></div><table class="table table-stats"><thead><th>Primary Stat</th><th>Value</th></thead><tbody><tr><td class="statname">Hitpoints</td><td id="stat-hitpoints" class="statvalue">1970</td></tr><tr><td class="statname">Combat Power</td><td id="stat-combat-power" class="statvalue">0</td></tr><tr><td class="statname">Attack Rating</td><td id="stat-attack-rating" class="statvalue">0</td></tr><tr><td class="statname">Weapon Power</td><td id="stat-weapon-power" class="statvalue">0</td></tr><tr><td class="statname">Heal Rating</td><td id="stat-heal-rating" class="statvalue">0</td></tr></tbody></table></div><div id="table-offensive"><table class="table table-stats"><thead><th>Offensive Stat</th><th>Value</th></thead><tbody><tr><td class="statname">Critical Rating</td><td id="stat-critical-rating" class="statvalue">0 %</td></tr><tr><td class="statname">Critical Chance %</td><td id="stat-critical-chance" class="statvalue">0</td></tr><tr><td class="statname">Critical Power Rating</td><td id="stat-critical-power" class="statvalue">0</td></tr><tr><td class="statname">Critical Power</td><td id="stat-critical-power-percentage" class="statvalue">0 %</td></tr><tr><td class="statname">Penetration Rating</td><td id="stat-penetration-rating" class="statvalue">0</td></tr><tr><td class="statname">Hit Rating</td><td id="stat-hit-rating" class="statvalue">0</td></tr></tbody></table></div><div id="table-defensive"><table class="table table-stats"><thead><th>Defensive Stat</th><th>Value</th></thead><tbody><tr><td class="statname">Block Rating</td><td id="stat-block-rating" class="statvalue">0</td></tr><tr><td class="statname">Defense Rating</td><td id="stat-defense-rating" class="statvalue">0</td></tr><tr><td class="statname">Evade Rating</td><td id="stat-evade-rating" class="statvalue">0</td></tr><tr><td class="statname">Evade Chance %</td><td id="stat-evade-chance" class="statvalue">0 %</td></tr><tr><td class="statname">Physical Protection</td><td id="stat-physical-protection" class="statvalue">249</td></tr><tr><td class="statname">Magical Protection</td><td id="stat-magical-protection" class="statvalue">249</td></tr></tbody></table></div><div id="raid-stats"><h5>Raid items</h5><label class="checkbox inline" data-toggle="tooltip" title="Activate bonuses from NY raid items, if they have a bonus applicable to the summary sheet. The bonus counts as you had procced all NY Raid items simultaneously or instantly got 10 stacks of the effect."><input type="checkbox" id="summary-activate-raid">Activate NY Raid items</label></div></div>')}dust.register("summary",a)}(),$(document).ready(function(){tswcalc.init()});var tswcalc=tswcalc||{};tswcalc=function(){var a=function(){$("#btn-reset").trigger("click")},b=function(){$(".glyph-tooltip, .signet-tooltip, .consumable-tooltip").tooltip({placement:"left"}),$(".cost-tooltip").tooltip({placement:function(a,b){return $(b).position().top<50?"bottom":"top"}}),$("#table-primary > label").tooltip({placement:"left"}),$("#raid-stats > label").tooltip({placement:"bottom"}),$(".cost-tooltip, .glyph-tooltip, .signet-tooltip, .slot-warning, .swap-weapon, .consumable-tooltip").on("click",function(a){a.preventDefault(),a.stopPropagation()})},c=function(a){dust.render("container",{slots:tswcalc.data.template_data.slots,signets:tswcalc.data.signet_data},function(a,b){a&&console.log(a),$(".container").html(b)})},d=function(){var a=$.getUrlVars();return(!$.isEmptyObject(a)&&8==Object.keys(a).length||9==Object.keys(a).length)&&(tswcalc.import.start(a),!0)},e=function(){tswcalc.slots.init(),tswcalc.miscslot.init();for(var a=0;a<tswcalc.data.template_data.slots.length;a++)g(tswcalc.data.template_data.slots[a]);tswcalc.button.init(),tswcalc.buttonBar.init(),tswcalc.summary.init(),tswcalc.export.init()},f=function(){""==location.hash&&(location.hash=" ")},g=function(a){tswcalc.select[a.id_prefix]=new tswcalc.select.SelectHandler(a),tswcalc.select[a.id_prefix].initiate()};return{init:function(){c(tswcalc.data.template_data),f(),b(),e(),d()||a(),$("#summary").scrollToFixed()}}}();var tswcalc=tswcalc||{};tswcalc.summary=function(){var a={},b=function(){return{black_bullion_cost:$("#bb-cost"),pantheon_cost:$("#pantheon-cost"),criterion_upgrade_cost:$("#cu-cost"),astral_fuse_cost:$("#af-cost"),supernal_upgrade_cost:$("#su-cost"),eleventh_hour_cost:$("#11th-cost"),activateRaid:$("#summary-activate-raid"),includeItemCosts:$("#summary-include-item-costs")}},c=function(){a=b(),d()},d=function(){a.activateRaid.on("change",e),a.includeItemCosts.on("change",f)},e=function(a){f()},f=function(){i(),j(),n(),p(),g()},g=function(a){window.location.hash=tswcalc.export.createExportUrl()},h=function(){return{primary:l(),offensive_defensive:o()}},i=function(){var b=0,c=0,d=0,e=0,f=0,g=0;for(var h in tswcalc.slots)if(tswcalc.slots.hasSlot(h)){var i=tswcalc.slots[h];b+=i.blackBullionCost(),c+=i.markOfThePantheonCost(),d+=i.criterionUpgradeCost(),e+=i.supernalUpgradeCost(),f+=i.astralFuseCost(),g+=i.eleventhHourCost()}a.includeItemCosts.is(":checked")&&(b+=tswcalc.data.costs.item.criterion.bullion*d,c+=tswcalc.data.costs.item.criterion.pantheon*d,b+=tswcalc.data.costs.item.astral.bullion*f,c+=tswcalc.data.costs.item.astral.pantheon*f),a.black_bullion_cost.html(b),a.pantheon_cost.html(c),a.criterion_upgrade_cost.html(d),a.supernal_upgrade_cost.html(e),a.astral_fuse_cost.html(f),a.eleventh_hour_cost.html(g)},j=function(){var a=l();for(var b in a)a.hasOwnProperty(b)&&k(b,a[b])},k=function(a,b){$("#stat-"+a).text(b)},l=function(){var a={"combat-power":0,"weapon-power":75,hitpoints:2070,"attack-rating":0,"heal-rating":0};for(var b in tswcalc.slots)if(tswcalc.slots.hasSlot(b)){var c=tswcalc.slots[b];if(c.isWeapon()&&!c.weaponDrawn)continue;var d=c.ql();if("major"==c.group){var e=c.signet();0!==e.id&&e.id<80&&(a[e.stat]+=c.determineSignetQualityValue(e))}if(c.isWeapon())a["weapon-power"]=tswcalc.data.custom_gear_data[c.group][d].weapon_power;else switch(c.item().role){case"dps":a["attack-rating"]+=tswcalc.data.custom_gear_data[c.group].heal_dps["ql"+d].rating;break;case"healer":a["heal-rating"]+=tswcalc.data.custom_gear_data[c.group].heal_dps["ql"+d].rating;break;case"tank":a.hitpoints+=tswcalc.data.custom_gear_data[c.group].tank["ql"+d].hitpoints;break;default:console.log("Illegal role value when collecting primary stats")}}return tswcalc.miscslot.pureAnima().bonus.forEach(function(b){a[b.stat]+=b.add}),a["combat-power"]=m(a["attack-rating"],a["weapon-power"]),a},m=function(a,b){if(a<5200)return Math.round((375-600/(Math.pow(Math.E,a/1400)+1))*(1+b/375));var c=8e-5*b+.0301;return Math.round(204.38+.5471*b+c*a)},n=function(){var a=o();t(a)},o=function(){var b={"critical-rating":0,"critical-chance":0,"critical-power":0,"critical-power-percentage":0,"penetration-rating":0,"hit-rating":0,"block-rating":0,"defense-rating":0,"evade-rating":0,"evade-chance":0,"physical-protection":300,"magical-protection":300};for(var c in tswcalc.slots)if(tswcalc.slots.hasSlot(c)){var d=tswcalc.slots[c];if(d.isWeapon()&&!d.weaponDrawn)continue;b[d.primaryGlyph()]+=d.primaryGlyphValue(),b[d.secondaryGlyph()]+=d.secondaryGlyphValue()}var e=tswcalc.miscslot.anima();if(b[e.bonus.stat]+=e.bonus.add,b["critical-power-percentage"]=r(b["critical-power"]),a.activateRaid.is(":checked"))for(var c in tswcalc.slots)if(tswcalc.slots.hasSlot(c)){var f=tswcalc.slots[c].signet();if(void 0!==f.bonus)for(var g=0;g<f.bonus.stat.length;g++)void 0!==f.bonus.add?b[f.bonus.stat[g]]+=f.bonus.add:void 0!==f.bonus.multiply&&(b[f.bonus.stat[g]]=f.bonus.multiply*b[f.bonus.stat[g]])}return b["critical-chance"]=q(b["critical-rating"]),b["evade-chance"]=s(b["evade-rating"]),b["critical-rating"]=parseInt(b["critical-rating"].toFixed(0),10),b["critical-chance"]=b["critical-chance"].toFixed(1),b["critical-power-percentage"]=b["critical-power-percentage"].toFixed(2),b["penetration-rating"]=parseInt(b["penetration-rating"].toFixed(0),10),b["evade-chance"]=b["evade-chance"].toFixed(1),b["magical-protection"]=parseInt(b["magical-protection"].toFixed(0),10),b["physical-protection"]=parseInt(b["physical-protection"].toFixed(0),10),b},p=function(){for(var a in tswcalc.slots)if(tswcalc.slots.hasSlot(a)){var b=tswcalc.slots[a];b.updateGlyphValues()}},q=function(a){return 55.14-100.3/(Math.pow(Math.E,a/790.3)+1)},r=function(a){return Math.sqrt(5*a+625)},s=function(a){return 30.1-50.14/(Math.pow(Math.E,a/704.7)+1)},t=function(a){for(var b in a)a.hasOwnProperty(b)&&(a[b]>0?$("#stat-"+b).html(u(b)?a[b].toString().substring(0,4)+" %":"+"+a[b]):$("#stat-"+b).html(u(b)?"0 %":"0"))},u=function(a){return"critical-power-percentage"==a||"critical-chance"==a||"evade-chance"==a};return{init:c,calculateCriticalChance:q,calculateCriticalPowerPercentage:r,calculateEvadeChance:s,calculateCombatPower:m,collectPrimaryStats:l,collectOffensiveDefensiveStats:o,collectAllStats:h,updateAllStats:f,checkActivateRaid:function(){a.activateRaid.prop("checked",!0),a.activateRaid.change()},checkIncludeItemCosts:function(){a.includeItemCosts.prop("checked",!0),a.includeItemCosts.change()}}}();var tswcalc=tswcalc||{};tswcalc.select=tswcalc.select||{},tswcalc.select.SelectHandler=function(a){var b=this,c=tswcalc.slots[a.id_prefix];this.initiate=function(){this.bindEvents(),this.addSignetsToSelect(),this.addItemsToSelect()},this.bindEvents=function(){c.isWeapon()?c.el.wtype.change(this.wtypeChange):c.el.itemId.change(this.itemChange),c.el.ql.change(this.qlChange),c.el.glyphQl.change(this.glyphChange),c.el.primaryGlyph.change(this.glyphChange),c.el.secondaryGlyph.change(this.glyphChange),c.el.signetId.change(this.signetChange),c.el.signetQuality.change(this.signetChange)},this.addItemsToSelect=function(){var b=tswcalc.data.findItems(a.group);"head"!=a.id_prefix&&(b=b.concat(tswcalc.data.findItems(a.id_prefix))),b.forEach(function(a){c.el.itemId.append($("<option>",{value:a.id,text:a.name}))})},this.addSignetsToSelect=function(){c.el.signetId.append($("<option>",{value:"none",text:"None",selected:"true"})),this.updateToDefaultSignet();var b=$.merge([],tswcalc.data.signet_data[a.group]);$.merge(b,this.getSignetsForHead(a.group)),$.merge(b,this.getSignetsForSlot()),b.sort(function(a,b){return a.name.toLowerCase()>b.name.toLowerCase()?1:-1}),$.each(b,function(a,b){c.el.signetId.append($("<option>",{value:b.id,text:b.name}))})},this.updateToDefaultSignet=function(){var b="assets/images/icons/"+a.group+"_dps.png";$("#"+a.id_prefix+"-signet-img-icon").attr("src",b),$("#"+a.id_prefix+"-signet-img-quality").attr("src","assets/images/icons/normal.png")},this.getSignetsForHead=function(a){return"head"==a?tswcalc.data.signet_data.weapon:[]},this.getSignetsForSlot=function(){return"head"!==a.id_prefix&&"weapon"!==a.id_prefix&&void 0!==tswcalc.data.signet_data[a.id_prefix]?tswcalc.data.signet_data[a.id_prefix]:[]},this.signetChange=function(b){var d=c.signet();if(void 0!==d.requires){var e=tswcalc.data.cadoro_items[d.requires],f=e[a.id_prefix][c.item().role];void 0!==f&&""!==f.name&&c.name(": "+f.name),c.signetQuality("epic"),c.el.signetQuality.attr("disabled","disabled"),c.el.nameWarning.tooltip({title:e.warning_text,placement:"top"}),c.el.nameWarning.show()}else c.item().signet||(c.el.signetQuality.removeAttr("disabled"),c.el.nameWarning.hide());c.updateSignet(),tswcalc.summary.updateAllStats()},this.itemChange=function(a){b.enableControls(),b.updateControlsForItem(),tswcalc.summary.updateAllStats()},this.wtypeChange=function(a){var b=$(this).val();"none"!=b?c.name(": "+tswcalc.util.capitalise(b)):c.name("")},this.qlChange=function(a){tswcalc.summary.updateAllStats()},this.glyphChange=function(a){b.updateGlyphDistributionButtons(),tswcalc.summary.updateAllStats()},this.updateGlyphDistributionButtons=function(){"11.0"===c.el.glyphQl.val()?(this.updateGlyphDistributionButton(c.el.btn.primary[1],!1,"top"),this.updateGlyphDistributionButton(c.el.btn.primary[3],!1,"top"),this.updateGlyphDistributionButton(c.el.btn.secondary[1],!1,"bottom"),this.updateGlyphDistributionButton(c.el.btn.secondary[3],!1,"bottom"),1!=c.primaryDist()&&3!=c.primaryDist()||(c.el.btn.primary[4].trigger("click"),c.el.btn.secondary[0].trigger("click"))):(this.updateGlyphDistributionButton(c.el.btn.primary[1],!0,"top"),this.updateGlyphDistributionButton(c.el.btn.primary[3],!0,"top"),this.updateGlyphDistributionButton(c.el.btn.secondary[1],!0,"bottom"),this.updateGlyphDistributionButton(c.el.btn.secondary[3],!0,"bottom"))},this.updateGlyphDistributionButton=function(a,b,c){b?(a.removeAttr("disabled"),a.next("div").remove()):(a.attr("disabled","disabled"),a.after(function(b){return d=$("<div>"),d.css({height:a.outerHeight(),width:a.outerWidth(),position:"absolute"}),d.css(a.position()),d.attr("title","QL11 glyphs do not support 1/3 splits."),d.tooltip({placement:c}),d}))},this.updateControlsForItem=function(){var a=c.item();c.name(": "+a.name),a.ql&&(Array.isArray(a.ql)?c.el.ql.find("option").each(function(b,d){-1==a.ql.indexOf(d.value)&&(c.ql()==d.value&&c.ql(a.ql[0]),$(this).attr("disabled","disabled"))}):(c.ql(a.ql),c.el.ql.attr("disabled","disabled"))),a.glyph&&(c.glyphQl(a.glyph.ql),c.primaryGlyph(a.glyph.primary.stat),c.secondaryGlyph(a.glyph.secondary.stat),c.el.btn.primary[a.glyph.primary.dist].trigger("click"),c.el.btn.secondary[a.glyph.secondary.dist].trigger("click"),c.el.ql.attr("disabled","disabled"),c.el.glyphQl.attr("disabled","disabled"),c.el.primaryGlyph.attr("disabled","disabled"),c.el.secondaryGlyph.attr("disabled","disabled"),b.disableAllGlyphDistButtonsExcept(c.el.btn.primary,a.glyph.primary.dist),b.disableAllGlyphDistButtonsExcept(c.el.btn.secondary,a.glyph.secondary.dist)),a.signet&&(c.updateSignet(),c.signetQuality(a.signet.quality),c.el.signetId.attr("disabled","disabled"),c.el.signetQuality.attr("disabled","disabled"),c.el.signetId.append($("<option>",{value:999,text:a.signet.name,selected:!0}))),c.el.signetId.change()},this.disableAllGlyphDistButtonsExcept=function(a,b){for(var c=0;c<=4;c++)c!==b&&a[c].attr("disabled","disabled")},this.enableAllGlyphDistButtons=function(a){for(var b=0;b<=4;b++)a[b].removeAttr("disabled")},this.enableControls=function(){b.enableAllGlyphDistButtons(c.el.btn.primary),b.enableAllGlyphDistButtons(c.el.btn.secondary),c.el.glyphQl.removeAttr("disabled"),c.el.primaryGlyph.removeAttr("disabled"),c.el.secondaryGlyph.removeAttr("disabled"),c.el.ql.removeAttr("disabled"),c.el.ql.find("option[disabled]").removeAttr("disabled"),c.el.signetId.removeAttr("disabled"),"heroic"===c.signetQuality()&&c.signetQuality("none"),c.el.signetQuality.removeAttr("disabled"),
c.el.signetId.find("option[value=999]").remove(),c.updateSignet(),c.el.signetId.change(),tswcalc.summary.updateAllStats()}};var tswcalc=tswcalc||{};tswcalc.button=function(){var a={},b={},c=function(){for(var b=0;b<tswcalc.data.template_data.slots.length;b++){var c=tswcalc.data.template_data.slots[b].id_prefix;a[c]=new tswcalc.button.DistributionButtonHandler(c),a[c].init()}d("weapon"),d("weapon2")},d=function(a){b[a]=new tswcalc.button.SwapWeaponButton(a),b[a].init()};return{init:c}}(),tswcalc.button.SwapWeaponButton=function(a){var b=this;this.init=function(){this.bindEvents()},this.bindEvents=function(){$("#"+a+"-swap-weapon").on("click",this.weaponSwap)},this.weaponSwap=function(c){tswcalc.slots[a].sheathWeapon(),tswcalc.slots[b.otherWeapon()].drawWeapon(),tswcalc.summary.updateAllStats()},this.otherWeapon=function(){return"weapon"==a?"weapon2":"weapon"}},tswcalc.button.DistributionButtonHandler=function(a){var b=this;this.init=function(){this.bindEvents(),this.setInitialState()},this.bindEvents=function(){this.bindButtonEvents("primary"),this.bindButtonEvents("secondary")},this.bindButtonEvents=function(c){$.each(tswcalc.slots[a].el.btn[c],function(a,c){c.on("click",function(a){var c=a.target.id;b.activate(c.split("-")[1],c.substring(c.length-1,c.length)),b.balance(c.split("-")[1]),tswcalc.summary.updateAllStats()})})},this.setInitialState=function(){this.activate("primary",4),this.activate("secondary",0)},this.balance=function(a){var c=b.inverse(a),d=b.getDist(a),e=b.getDist(c),f=d+e;f>4?b.activate(c,e-(f-4)):4==f||b.activate(c,4-d)},this.getDist=function(b){var c=tswcalc.slots[a];return"primary"==b?parseInt(c.primaryDist(),10):parseInt(c.secondaryDist(),10)},this.activate=function(b,c){var d=tswcalc.slots[a].el.btn[b][c];d.siblings().removeClass("active"),d.siblings().removeClass("btn-success"),d.addClass("active"),d.addClass("btn-success")},this.inverse=function(a){return"primary"==a?"secondary":"primary"}};var tswcalc=tswcalc||{};tswcalc.buttonBar=function(){var a={},b=function(){return{btn_all_dps:$("#btn-all-3"),btn_all_healer:$("#btn-all-2"),btn_all_tank:$("#btn-all-1"),btn_all_10_4:$("#btn-all-10-4"),btn_all_10_5:$("#btn-all-10-5"),btn_all_10_9:$("#btn-all-10-9"),btn_all_11_0:$("#btn-all-11-0"),btn_reset:$("#btn-reset")}},c=function(){a=b(),d()},d=function(){a.btn_all_dps.on("click",e),a.btn_all_healer.on("click",e),a.btn_all_tank.on("click",e),a.btn_all_10_4.on("click",f),a.btn_all_10_5.on("click",f),a.btn_all_10_9.on("click",f),a.btn_all_11_0.on("click",f),a.btn_reset.on("click",g)},e=function(a){var b=j(a);for(var c in tswcalc.slots)if(tswcalc.slots.hasSlot(c)){var d=tswcalc.slots[c];d.itemId(b),d.el.itemId.change()}tswcalc.summary.updateAllStats()},f=function(a){var b=h(a),c=i(a);for(var d in tswcalc.slots)if(tswcalc.slots.hasSlot(d)){var e=tswcalc.slots[d];e.item().ql||e.ql(b),e.item().glyph||(e.glyphQl(c),e.el.glyphQl.change())}tswcalc.summary.updateAllStats()},g=function(a){tswcalc.slots.reset(),tswcalc.summary.updateAllStats()},h=function(a){return a.target.id.split("-")[2]+"."+a.target.id.split("-")[3]},i=function(a){var b=parseInt(a.target.id.split("-")[2]),c=parseInt(a.target.id.split("-")[3]);return 10===b&&c>5?"10.5":b+"."+c},j=function(a){return a.target.id.split("-")[2]};return{el:a,init:c,setRoleOnAllSlots:e,setQlOnAllSlots:f,resetAllSlots:g}}();var tswcalc=tswcalc||{};tswcalc.export=function(){var a=0,b={},c={},d=function(){return{export_btn:$("a.export"),export_textarea:$("#export-textarea"),open_export_modal:$("#open-export-modal")}},e=function(){c=d(),f()},f=function(){c.export_btn.on("click",function(b){a=$(b.target).attr("data"),g()}),c.open_export_modal.on("shown",function(){c.export_textarea.focus()}),c.export_textarea.focus(function(){$(this).select(),$(this).mouseup(function(){return $(this).unbind("mouseup"),!1})})},g=function(){"url"==a?h():"bbcode"==a&&k()},h=function(){m();var a=i();c.export_textarea.attr("rows","1"),c.export_textarea.html(location.origin+location.pathname+"#"+a)},i=function(){var a="",b=0;for(var c in tswcalc.slots)if(tswcalc.slots.hasSlot(c)){var d=tswcalc.slots[c];a+=j(d,d.mappedState()),b<tswcalc.slots.length()-1&&(a+="&"),b++}return a},j=function(a,b){var c=b.itemId;a.isWeapon()&&(c=b.wtype);var d=a.id+"="+b.ql+","+c+","+b.glyph_ql+","+b.primary_glyph+","+b.secondary_glyph+","+b.primary_dist+","+b.secondary_dist;return 0!==b.signet_id&&"999"!==b.signet_id&&(d+=","+b.signet_quality+","+b.signet_id),d},k=function(){m(),dust.render("export\bbcode",{slotState:l(),summary:tswcalc.summary.collectAllStats()},function(a,b){a&&console.log(a),c.export_textarea.attr("rows","10"),c.export_textarea.html(b)})},l=function(){for(var a=[],c=0;c<tswcalc.data.template_data.slots.length;c++){var d=tswcalc.data.template_data.slots[c],e=d.id_prefix,f=d.group,g=b[e],h=tswcalc.slots[e].primaryGlyphValue(),i=tswcalc.slots[e].secondaryGlyphValue(),j=0,k=0;if(tswcalc.data.template_data.slots[c].is_weapon)j="Weapon Power",k=tswcalc.data.custom_gear_data[f]["10."+g.ql].weapon_power;else switch(g.role){case"healer":j="Heal Rating",k=tswcalc.data.custom_gear_data[f].heal_dps["ql10."+g.ql].rating;break;case"dps":j="Attack Rating",k=tswcalc.data.custom_gear_data[f].heal_dps["ql10."+g.ql].rating;break;case"tank":j="Hitpoints",k=tswcalc.data.custom_gear_data[f].tank["ql10."+g.ql].hitpoints}var l=tswcalc.slots[e].signet(),m={name:d.is_weapon?tswcalc.util.capitalise(d.name+": "+tswcalc.util.capitalise(tswcalc.data.wtype_mapping.to_name[g.wtype])):tswcalc.util.capitalise(e),role:d.is_weapon?null:"dps"===g.role?"DPS":tswcalc.util.capitalise(g.role),ql:g.ql,stat_type:j,stat_value:k,glyph_ql:g.glyph_ql,primary_glyph:tswcalc.util.blankIfNone(tswcalc.util.capitalise(tswcalc.data.stat_mapping.to_stat[g.primary_glyph])),primary_dist:g.primary_dist,primary_value:h,secondary_glyph:tswcalc.util.blankIfNone(tswcalc.util.capitalise(tswcalc.data.stat_mapping.to_stat[g.secondary_glyph])),secondary_dist:g.secondary_dist,secondary_value:i,signet_name:l.name,signet_quality:tswcalc.util.blankIfNone(tswcalc.util.capitalise(tswcalc.data.signet_quality_mapping.to_name[g.signet_quality])),signet_description:tswcalc.slots[e].signetDescription(),signet_colour:tswcalc.data.signet_quality_mapping.to_colour[tswcalc.data.signet_quality_mapping.to_name[g.signet_quality]],is_item:g.itemId>3};a.push(m)}return a},m=function(){b=tswcalc.slots.mappedState()};return{init:e,createSlotUrl:j,createExportUrl:i,collectAllSlotStates:m,startExportUrl:h,startExportBBCode:k}}();var tswcalc=tswcalc||{};tswcalc.import=function(){var a=function(a,c){var d=tswcalc.slots[a];if(c[0]>10?d.ql("11.0"):d.ql("10."+c[0]),d.isWeapon()?(d.wtype(tswcalc.data.wtype_mapping.to_name[c[1]]),d.el.wtype.change()):(d.itemId(c[1]),d.el.itemId.change()),c[2]>10?(d.glyphQl("11.0"),d.el.glyphQl.change()):d.glyphQl("10."+c[2]),d.primaryGlyph(tswcalc.data.stat_mapping.to_stat[c[3]]),d.secondaryGlyph(tswcalc.data.stat_mapping.to_stat[c[4]]),d.el.btn.primary[c[5]].click(),d.el.btn.secondary[c[6]].click(),void 0!==c[7]&&void 0!==c[8]&&"999"!==c[8])if(c[8]>=80&&c[8]<=92)d.itemId(c[8]),d.el.itemId.change();else{var e=tswcalc.data.signet_quality_mapping.to_name[c[7]],f="0"!=c[8]?c[8]:"none";b(a,e,f)}},b=function(a,b,c){var d=tswcalc.slots[a];d.signetQuality(b),d.signetId(c),d.el.signetId.change()};return{start:function(b){for(var c in b)b.hasOwnProperty(c)&&(splitVars=b[c].split(","),a(c,splitVars));tswcalc.summary.updateAllStats()}}}();var tswcalc=tswcalc||{};tswcalc.util=function(){return{capitalise:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},blankIfNone:function(a){return"None"==a||"none"==a?"":a}}}(),Array.prototype.find||(Array.prototype.find=function(a){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return b});var tswcalc=tswcalc||{};tswcalc.slots=function(){var a=function(){for(var a=0;a<tswcalc.data.template_data.slots.length;a++){var c=tswcalc.data.template_data.slots[a];this[c.id_prefix]=new tswcalc.slots.Slot(c.id_prefix,c.name,c.group),this[c.id_prefix].el.nameWarning.hide()}b()},b=function(){tswcalc.slots.weapon2.sheathWeapon(),tswcalc.slots.weapon.weaponDrawn=!0},c=function(){return tswcalc.data.template_data.slots.length},d=function(){return["head","weapon","weapon2","ring","neck","wrist","luck","waist","occult"]};return{init:a,length:c,indices:d,hasSlot:function(a){return this.hasOwnProperty(a)&&-1!=$.inArray(a,d())},reset:function(){for(var a in this)this.hasSlot(a)&&this[a].reset()},state:function(){var a={};for(var b in this)this.hasSlot(b)&&(a[b]=this[b].state());return a},mappedState:function(){var a={};for(var b in this)this.hasSlot(b)&&(a[b]=this[b].mappedState());return a}}}(),tswcalc.slots.Slot=function(a,b,c){this.id=a,this.name=b,this.group=c,this.weaponDrawn=!1,this.el={div:$("#"+this.id+"-slot"),name:$("#"+this.id+"-name"),itemId:$("#"+this.id+"-itemId"),wtype:$("#"+this.id+"-wtype"),ql:$("#"+this.id+"-ql"),glyphQl:$("#"+this.id+"-glyph-ql"),primaryGlyph:$("#"+this.id+"-primary-glyph"),secondaryGlyph:$("#"+this.id+"-secondary-glyph"),primaryDist:"#"+this.id+"-primary-glyph-dist > button.btn.active",secondaryDist:"#"+this.id+"-secondary-glyph-dist > button.btn.active",primaryGlyphValue:$("#"+this.id+"-primary-glyph-value"),secondaryGlyphValue:$("#"+this.id+"-secondary-glyph-value"),signetId:$("#"+this.id+"-pick-signet"),signetQuality:$("#"+this.id+"-signet-quality"),signetIconImg:$("#"+this.id+"-signet-img-icon"),signetIconBorderImg:$("#"+this.id+"-signet-img-quality"),signetDescription:$("#"+this.id+"-signet-description"),nameWarning:$("#"+this.id+"-name-warning"),btn:{primary:{0:$("#"+this.id+"-primary-glyph-dist-btn0"),1:$("#"+this.id+"-primary-glyph-dist-btn1"),2:$("#"+this.id+"-primary-glyph-dist-btn2"),3:$("#"+this.id+"-primary-glyph-dist-btn3"),4:$("#"+this.id+"-primary-glyph-dist-btn4")},secondary:{0:$("#"+this.id+"-secondary-glyph-dist-btn0"),1:$("#"+this.id+"-secondary-glyph-dist-btn1"),2:$("#"+this.id+"-secondary-glyph-dist-btn2"),3:$("#"+this.id+"-secondary-glyph-dist-btn3"),4:$("#"+this.id+"-secondary-glyph-dist-btn4")},itemSelect:$("#"+this.id+"item-select")}},this.name=function(){if(1!=arguments.length)return this.el.name.html();this.el.name.html(arguments[0])},this.isWeapon=function(){return"weapon"==this.group},this.item=function(){var a=this.itemId(),b=tswcalc.data.items.find(function(b){return b.id==a});return b||tswcalc.data.items[0]},this.itemId=function(){if(1!=arguments.length)return"weapon"!=this.group?this.el.itemId.val():"none";this.el.itemId.val(arguments[0])},this.wtype=function(){if(1!=arguments.length)return"weapon"==this.group?this.el.wtype.val():"none";this.el.wtype.val(arguments[0])},this.ql=function(){if(1!=arguments.length)return this.el.ql.val();this.el.ql.val(arguments[0])},this.glyphQl=function(){if(1!=arguments.length)return this.el.glyphQl.val();this.el.glyphQl.val(arguments[0])},this.primaryGlyph=function(){if(1!=arguments.length)return this.el.primaryGlyph.val();this.el.primaryGlyph.val(arguments[0])},this.secondaryGlyph=function(){if(1!=arguments.length)return this.el.secondaryGlyph.val();this.el.secondaryGlyph.val(arguments[0])},this.primaryGlyphValue=function(){return"none"==this.primaryGlyph()?0:tswcalc.data.glyph_data.stat[this.primaryGlyph()].ql[this.glyphQl()].slot[this.group].dist[this.primaryDist()]},this.secondaryGlyphValue=function(){return"none"==this.secondaryGlyph()?0:tswcalc.data.glyph_data.stat[this.secondaryGlyph()].ql[this.glyphQl()].slot[this.group].dist[this.secondaryDist()]},this.primaryDist=function(){return $(this.el.primaryDist)[0].innerHTML},this.secondaryDist=function(){return $(this.el.secondaryDist)[0].innerHTML},this.sheathWeapon=function(){this.isWeapon()&&(this.weaponDrawn=!1,this.el.div.hide())},this.drawWeapon=function(){this.isWeapon()&&(this.weaponDrawn=!0,this.el.div.show())},this.itemCost=function(){return this.item().id>3?{bullion:0,pantheon:0}:tswcalc.data.costs[this.isWeapon()?"weapon":"talisman"][this.ql()]},this.glyphCost=function(){return this.item().glyph?{bullion:0,pantheon:0}:tswcalc.data.costs.glyph[this.glyphQl()]},this.blackBullionCost=function(){var a=0;return a+=this.glyphCost().bullion,a+=this.itemCost().bullion},this.markOfThePantheonCost=function(){return this.itemCost().pantheon||0},this.astralFuseCost=function(){return this.glyphCost().astral_fuse?1:0},this.criterionUpgradeCost=function(){return this.itemCost().criterion_upgrade?1:0},this.supernalUpgradeCost=function(){return this.itemCost().supernal_upgrade?1:0},this.eleventhHourCost=function(){return this.glyphCost().eleventh_hour_kit?1:0},this.signetId=function(){if(1!=arguments.length)return this.el.signetId.val();this.el.signetId.val(arguments[0])},this.signetQuality=function(){if(1!=arguments.length)return null===this.el.signetQuality.val()?"heroic":this.el.signetQuality.val();this.el.signetQuality.val(arguments[0])},this.signet=function(){return this.item()&&this.item().signet?this.item().signet:(foundSignet=tswcalc.data.signet_data.find(this.group,this.signetId()),0==foundSignet.id&&void 0!==tswcalc.data.signet_data[this.id]?foundSignet=tswcalc.data.signet_data.find(this.id,this.signetId()):0!==foundSignet||void 0!==foundSignet?foundSignet:null)},this.signetDescription=function(){var a=this.signet();if(null===a)return"";var b=a.description;return a.quality&&(b=b.replace("%s",this.determineSignetQualityValue(a)),b=b.replace("%d",this.determineSignetQualityValue(a)),"[object Array]"===Object.prototype.toString.call(a.quality)&&(b=b.replace("%0",this.determineSignetQualityValue(a,0)),b=b.replace("%1",this.determineSignetQualityValue(a,1)))),a.cooldown&&"0"!=a.cooldown&&(b+=" "+a.cooldown+" seconds cooldown."),b},this.determineSignetQualityValue=function(a,b){switch(b=void 0!==b?b:-1,this.signetQuality()){case"none":return 0;case"normal":return-1==b?a.quality.normal:a.quality[b].normal;case"elite":return-1==b?a.quality.elite:a.quality[b].elite;case"epic":return-1==b?a.quality.epic:a.quality[b].epic;case"heroic":return-1==b?a.quality.heroic:a.quality[b].heroic;default:return 0}},this.updateGlyphValues=function(){this.updatePrimaryGlyphValue(),this.updateSecondaryGlyphValue()},this.updatePrimaryGlyphValue=function(){this.el.primaryGlyphValue.html(0!==this.primaryGlyphValue()?"+"+this.primaryGlyphValue():0)},this.updateSecondaryGlyphValue=function(){this.el.secondaryGlyphValue.html(0!==this.secondaryGlyphValue()?"+"+this.secondaryGlyphValue():0)},this.updateSignet=function(){this.updateSignetIcon(),this.updateSignetDescription()},this.updateSignetIcon=function(){var a=this.signet(),b=this.signetQuality();0!==a.id&&"none"!=b?(this.updateSignetIconBorder(b),this.updateSignetIconImage(a)):0!==a.id&&"none"==b?this.signetQuality("normal"):"none"!=b&&0===a.id?(this.updateSignetIconBorder(b),this.updateSignetIconImageFromName(this.group+"_dps")):(this.updateSignetIconBorder("normal"),this.updateSignetIconImageFromName(this.group+"_dps"))},this.updateSignetIconBorder=function(a){var b="assets/images/icons/"+a+".png";this.el.signetIconBorderImg.attr("src",b)},this.updateSignetIconImage=function(a){this.updateSignetIconImageFromName(a.icon)},this.updateSignetIconImageFromName=function(a){var b="assets/images/icons/"+a+".png";this.el.signetIconImg.attr("src",b)},this.updateSignetDescription=function(){this.el.signetDescription.html(this.signetDescription())},this.reset=function(){this.wtype("none"),this.ql("10.0"),this.itemId("3"),this.el.itemId.change(),this.glyphQl("10.0"),this.primaryGlyph("none"),this.secondaryGlyph("none"),this.signetId("none"),this.signetQuality("none"),this.updateSignet(),this.el.btn.primary[4].trigger("click"),this.el.btn.secondary[0].trigger("click"),this.el.glyphQl.change()},this.state=function(){return{ql:this.ql(),role:this.item().role,glyph_ql:this.glyphQl(),primary_glyph:this.primaryGlyph(),secondary_glyph:this.secondaryGlyph(),primary_dist:this.primaryDist(),secondary_dist:this.secondaryDist(),signet_quality:this.signetQuality(),signet_id:this.signetId()}},this.mappedState=function(){return{itemId:this.item().id,wtype:this.stripContent(this.wtype()),role:this.isWeapon()?"":this.stripContent(this.item().role),ql:this.stripContent(this.ql()),glyph_ql:this.stripContent(this.glyphQl()),primary_glyph:this.stripContent(this.primaryGlyph()),secondary_glyph:this.stripContent(this.secondaryGlyph()),primary_dist:this.primaryDist(),secondary_dist:this.secondaryDist(),signet_quality:this.stripContent(this.signetQuality()),signet_id:this.stripContent(this.signetId())}},this.stripContent=function(a){null!=a&&"none"!=a||(a=0);var b=/\d+\.\d/;return 0!=a&&a.match(b)?a.match(/11\./)?"11":a.split(".")[1]:-1!=$.inArray(a,Object.keys(tswcalc.data.wtype_mapping.to_num))?tswcalc.data.wtype_mapping.to_num[a]:-1!=$.inArray(a,Object.keys(tswcalc.data.stat_mapping.to_num))?tswcalc.data.stat_mapping.to_num[a]:-1!=$.inArray(a,Object.keys(tswcalc.data.signet_quality_mapping.to_num))?tswcalc.data.signet_quality_mapping.to_num[a]:a}};var tswcalc=tswcalc||{};tswcalc.miscslot=function(){var a={},b=function(){return{pure_anima:{select:$("#pure-anima"),description:$("#pure-anima-description")},anima:{select:$("#anima"),description:$("#anima-description")}}},c=function(){a=b(),d()},d=function(){a.pure_anima.select.on("change",e),a.anima.select.on("change",f)},e=function(b){g("pure_anima",a.pure_anima.select.val()),tswcalc.summary.updateAllStats()},f=function(b){g("anima",a.anima.select.val()),tswcalc.summary.updateAllStats()},g=function(b,c){var d=tswcalc.data.consumables[b][c];void 0!==d&&a[b].description.html(d.description)};return{init:c,pureAnima:function(){if(1!=arguments.length)return tswcalc.data.consumables.pure_anima[a.pure_anima.select.val()];a.pure_anima.select.val(arguments[0])},anima:function(){if(1!=arguments.length)return tswcalc.data.consumables.anima[a.anima.select.val()];a.anima.select.val(arguments[0])}}}();